# Ansible Playbook для развертывания мониторинга и логирования

Этот проект содержит Ansible роли для развертывания и настройки системы мониторинга и логирования, включающую следующие компоненты:

- Prometheus
- Node Exporter
- ElasticSearch и Kibana
- Fluent-bit

## Структура ролей

### 1. Роль для развертывания Prometheus
- Создание пользователей и директорий с необходимыми правами.
- Установка Prometheus.
- Добавление конфигурации Prometheus с прописанным таргетом для мониторинга самого Prometheus.
- Создание и настройка systemd service файла для запуска Prometheus.
- Запуск и релоад сервиса при изменении глобальных параметров конфигурации.
- Параметры конфигурации вынесены в defaults.

### 2. Роль для развертывания Node Exporter
- Создание пользователей и директорий с необходимыми правами.
- Установка Node Exporter.
- Добавление systemd service файла для запуска Node Exporter.
- Добавление нового хоста для мониторинга в конфигурацию Prometheus.
- Обновление конфигурации Prometheus для добавления нового хоста, включая удаленные серверы.
- Запуск сервиса Node Exporter и релоад Prometheus сервиса при изменении конфигурации.

### 3. Роль для развертывания ElasticSearch и Kibana
- Создание пользователей и директорий с необходимыми правами.
- Установка ElasticSearch.
- Установка Kibana.
- Добавление systemd service файлов для запуска ElasticSearch и Kibana.
- Запуск сервисов и настройка для автоматического старта.

### 4. Роль для развертывания FluentBit
- Создание пользователей и директорий с необходимыми правами.
- Установка FluentBit.
- Добавление systemd service файла для FluentBit.
- Добавление конфигурации для сбора логов из journald и пересылки их в установленный ElasticSearch.
- Запуск сервиса FluentBit.

## Использование

### Требования

- Ansible версии 2.9 и выше.
- Ubuntu 20.04 или 22.04.
- Необходимые зависимости из requirements.txt.

### Структура проекта
```
ansible/
├── roles/
│   ├── prometheus/
│   ├── node_exporter/
│   ├── elasticsearch_kibana/
│   └── fluentbit/
└── site.yml
```

### Запуск плейбука использования

Запустите плейбук с командой:

ansible-playbook site.yml

### Параметры по умолчанию

Все параметры конфигурации могут быть настроены в defaults/main.yml каждой роли.
